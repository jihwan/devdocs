---
layout: post
title: "ddd-start ch02 아키텍쳐 개요"
description: "ddd-start ch02 아키텍쳐 개요"
category: DDD
tags: [DDD]
---
{% include JB/setup %}

# 아키텍처 개요

## 네 개의 영역

- 표현
- 응용
- 도메인
- 인프라스트럭쳐

### 표현 영역

- 값 받기, 값 변환, 값 검증, 서비스 호출, view 선택, exception 처리.
- 전달 받은 데이터를 도메인 모델로 변환. (VO, DTO)
- 표현에서 응용으로 넘어가는 단계 부터 도메인 모델이 사용 된다고 생각.

### 응용 영역

- 시스템이 사용자에게 제공해야 할 기능을 구현한다.
- 응용영역의 기능을 구현하기 위해 도메인 영역의 도메인 모델을 사용한다.
- 로직을 직접 수행 해서는 안된다. 모든 핵심 도메인 로직은 도메인 모델로 위임.

### 도메인 영역

- 도메인 모델을 구현하고, 도메인 서비스를 제공.

### 인프라스트럭쳐 영역

- 실제 구현 기술

> **표현,응용,도메인 영역**에서는 **인프라스트럭쳐 영역의 구현 기술을 직접 다루지 않는다**

## 계층 구조 아키텍쳐

사실 표현,응용,도메인 계층은 인프라스트럭쳐 계층에 종속된다.
즉, 특정 기술에 종속된다는 말인데, 인프라스트럭처에 의존하면 `테스트 어려움`과 `기능 확장의 어려움` 두가지 문제가 발생한다.
이를 극복하는 방법은 SOLID를 이용하면 됨.
정확히 말하자면 ISP, DIP 원칙을 적용한다.
그리고, 이 두 원칙을 통해, SRP, OCP 효과를 볼 수 있다.

## DIP

### 고수준 모듈 vs 저수준 모듈

**고수준 모듈은 의미 있는 단일 기능을 제공하는 모듈.**
추상화된 기능을 제공하는 순수 객체로 인식. 특정 기술에 종속되어 있지 않음.
그 자체가 기능을 제공함에 있어 세부적인 구현을 담고 있지않다.
구현측면에서 보면 interface class 이다.

**저수준 모듈은 하위기능을 실제로 구현한 것.**
특정 기술에 종속될 가능성이 높음.
세부 구현을 표현한다.

**고수준 모듈은 응용이나 도메인 영역에 존재 할 가능성이 높다.**

설명을 위해(모든 원칙을 고려하지 않은 상태) 구현입장에서만 보면,
어떤 기능(도메인 로직)을 제공하기 위해 특정 기술을 이용한 코드를 직접 작성하여 구현을 한다.
고수준 영역에 있어야 할 코드가, 저수준의 코드와 섞여 있게 되다. 이로인해 테스트와 구현 교체가 어렵다.
책에서 설명하는 방식으로 표현하자면, 고수준이 저수준에 의존.
이런 부분(저수준에 의존하는)을 interface 로 추출하면, 고수준이 고수준에 의존하게 되고,
저수준은 interface로 추출된 고수준에 의존하여 구현을 하게 된다.
즉, 모든 의존이 고수준을 향하는 방향으로 뒤집혔음을 알 수 있다.

### DIP 구현시 주의사항

앞에서 고수준모듈, 저수준모듈 즉 모듈이라는 표현을 했다.
모듈은 구현시 package 정도 될 것이다. 저수준 모듈에 직접 의존하지 않기 위해 inteface로 추출한 객체는,
고수준 모듈이므로, 그 interface 위치 또한 고수준 모듈에 존재 해야 한다.

고수준 모듈은 응용, 도메인 영역이자 그 package 일 것이다.
저수준 모듈은 인프라스트럭쳐 영역이자 그 package 일 것이다.

### DIP와 아키텍쳐

인프라스트럭쳐 영역이 응용과 도메인 영역에 의존하게 된다.
최종적으로, 모든 영역이 도메인 영역에 의존하게 된다.

# 도메인 영역의 주요 구성요소

- Entity
- Value
- Aggregate
- Repository
- Domain Service

- 응용 서비스와 Repository 는 밀접한 연관이 있다.
  - 필요한 도메인 객체를 가져오거나 저장할 때 Repository 의존
  - Transaction 처리 단위가 됨.

# 요청 처리 흐름

# 인프라스트럭처 개요

구현의 편리함은 DIP가 주는 다른 장점(변경,테스트)만큼 중요하기 때문에
DIP의 장점을 해치지 않는 벙위에서 응용, 도메인 영역에서 구현 기술에 대한
의존을 가져가는 것이 현명하다.

# 모듈 구성

domain 모듈은 그 도메인이 속한 aggregate 기준으로 다시 패키지를 구성한다.

# 더 생각해 볼 문제

응용서비스 vs 도메인서비스 ?

DI(Dependency Injection) ?
객체 세상에서는 어떤 기능을 하기 위해, 여러 객체가 협력을 하게 된다.
협력을 한다는 것은 의존해서 함께 무언가를 한다는 것이다.
의존객체가 필요하다고 해서 내가 new 키워드를 이용하여 직접 생성하지 않고,
외부에서 받는다. 받는 방법은 생성자 혹은 수정자 메소드를 통해서...

IoC(Inversion of Control) ?
라이브러리와 프레임워크의 차이점을 알 필요가 있다.
`내가 조정하느냐? 조정당하느냐?`로 설명 가능하다.
객체 생성 관점에서만 보자면, IoC 같은 개념이 없을 경우,
내가 직접 new 키워드를 이용하여 객체 생성 후 그 객체가 생성하는 기능을 사용한다.
IoC 는 위에서 설명한 것과 반대 혹은 뒤집힌 개념이다. 내가 직접 제어 하지 않는다.
다만, IoC 에게 나는 이런 저런 객체를 사용할 것입니다 하고 설계도 같은 것만 제출하면 된다.
더 나아가 Container 개념까지 논하게 된다.
